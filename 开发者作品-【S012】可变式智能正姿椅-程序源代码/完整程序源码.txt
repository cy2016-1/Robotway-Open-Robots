#include <Servo.h> 
Servo myservo1;  // create servo object to control a servo 
Servo myservo2; 
Servo myservo3;
Servo myservo4; 
// a maximum of eight servo objects can be created 
const int TrigPin1=A1;       //设置发射脚位
const int EchoPin1=A0;      //设置接收脚位
const int TrigPin2=A5;       //设置发射脚位
const int EchoPin2=A4;      //设置接收脚位
float cm1;                 //浮点型数据类型（加小数点，提高精准度）
float cm2; 
int i;
int key=0;
int flag=1;
int tang=1;
int pos = 0;    // variable to store the servo position 

void setup() 
{ 
  Serial.begin(9600);
  pinMode(TrigPin1,OUTPUT);
  pinMode(EchoPin1,INPUT);
  pinMode(TrigPin2,OUTPUT);
  pinMode(EchoPin2,INPUT);
  pinMode(A2,INPUT);
  pinMode(A3,INPUT);
  pinMode(7,INPUT);
  pinMode(3,INPUT);
//  pinMode(8,INPUT);
  myservo1.attach(4);  // attaches the servo on pin 9 to the servo object
  myservo2.attach(12);  
  myservo3.attach(8);
  myservo4.attach(11);
} 


void loop() 
{
  while(digitalRead(7)==LOW)
  {
    while(digitalRead(A2)==LOW)
    {                         // in steps of 1 degree 
      myservo1.write(pos);    
      myservo2.write(50-pos);      // tell servo to go to position in variable 'pos' 
      delay(75);                       // waits 15ms for the servo to reach the position 
      pos+=1;  
      if(pos==50)
      {
        pos-=1;
      }
    }
    while(digitalRead(A3)==LOW)
    {  
      myservo1.write(pos);
      myservo2.write(50-pos);       // tell servo to go to position in variable 'pos' 
      delay(75);                       // waits 15ms for the servo to reach the position 
      pos-=1;  
      if(pos==0)
      {
        pos+=1;
      }
    }
  }
  while(digitalRead(7)==HIGH)
  {
    if(digitalRead(A2)==LOW)//guishi  
    {
      if(flag==1)
      {
        for(i=50;i<200;i++)
        {
          myservo3.write(i); 
          delay(100);
        }
      }
      else
      {
        for(i=200;i>50;i--)
        {
          myservo3.write(i); 
          delay(100);
        }
      }
      flag*=-1;
      delay(500);
    } 
    if(digitalRead(A3)==LOW)
    {
      if(tang==-1)
      {
        for(i=0;i<200;i++)
        {
          myservo4.write(i); 
        }
      }
      else
      {
        for(i=200;i>0;i--)
        {
          myservo4.write(i); 
          delay(100);
        }
      }
      tang*=-1;
      delay(500);
    }
    digitalWrite(TrigPin1,LOW);        //用低高低电平发送脉冲给Trigpin引脚
    delayMicroseconds(2);             //微秒级延时
    digitalWrite(TrigPin1,HIGH);
    delayMicroseconds(10);
    digitalWrite(TrigPin1,LOW);
    cm1=pulseIn(EchoPin1,HIGH)/58.0;    //读取脉冲宽度，换算成厘米

    digitalWrite(TrigPin2,LOW);
    delayMicroseconds(2); 
    digitalWrite(TrigPin2,HIGH);
    delayMicroseconds(10);
    digitalWrite(TrigPin2,LOW);
    cm2=pulseIn(EchoPin2,HIGH)/58.0;
    //Serial.print(cm2-cm1);                 //显示距离
    //Serial.print("cm");               //显示单位
    //Serial.println();                 //回车
    Serial.print(key);
    Serial.println();
    if( cm1<30 && cm2<30 )
    {
      if(cm2-cm1<-5||cm2-cm1>5)key+=1;
      else key-=1;
      if(key>5)
      {
        for(i=pos ; i < 50; i += 1)  // goes from 0 degrees to 180 degrees 
        {                                  // in steps of 1 degree 
          myservo1.write(i);              // tell servo to go to position in variable 'pos' 
          myservo2.write(50-i); 
          delay(15);                       // waits 15ms for the servo to reach the position 
        } 
        for(i = 50; i>=1; i-=1)     // goes from 180 degrees to 0 degrees 
        {                                
          myservo1.write(i);
          myservo2.write(50-i);           // tell servo to go to position in variable 'pos' 
          delay(15);                       // waits 15ms for the servo to reach the position 
        }
        for(i=0 ; i <= pos; i += 1)  // goes from 0 degrees to 180 degrees 
        {                                  // in steps of 1 degree 
          myservo1.write(i);
          myservo2.write(50-i);           // tell servo to go to position in variable 'pos' 
          delay(15);                       // waits 15ms for the servo to reach the position 
        }  
        key-=1;
      }
      else if(key<=0)
      {
        key+=1;
      }
      delay(1000);
    }
  }
} 